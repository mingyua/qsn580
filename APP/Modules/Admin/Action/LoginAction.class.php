<?php/**后台登录控制器*/Class LoginAction extends Action{	Public function index(){		$this->display();		}	Public function login(){		if(I('code','','md5') !=session('verify')){			die('验证码错误');			}		$username=I('username');		$pwd=I('password','','md5');		 $user=M('user')->where(array('username'=>$username))->find();			if($user)			 {				 session('username',$username);				 session('id',$user['id']);				 session(C('USER_AUTH_KEY'),$user['id']);				 if($_SESSION['username']==C('RBAC_SUPERADMIN')){				 session(C('ADMIN_AUTH_KEY'),true);					 }				import('ORG.Util.RBAC');				RBAC::saveAccessList();				 }		if(!$user || $user['password']!=$pwd){			die('账号或密码错误');			} 		if($user['lock']){die('用户被锁定,请联系管理员');}		$data=array(			'logintime'=>time(),			'loginip' =>get_client_ip(),					);	 	M('user')->where("id=$user[id]")->save($data);		session(C('USER_AUTH_KEY'),$user['id']);		session('username',$user['username']);		session('logintime',date('Y-m-d H:i:s',$user['logintime']));		session('loginip',$user['loginip']);		session('score',$user['score']);		session('userid',$user['id']);		echo 1;	}//登录验证码		Public function verify(){		import('ORG.Util.Image');		Image::buildImageVerify(C('VERIFY_LENGTH'),C('VERIFY_MODE'),'png',C('VERIFY_WIDTH'),C('VERIFY_HEIGHT'),'verify');				//Image::buildAnimateVerify(1,C('VERIFY_MODE'),80,30,'verify');			//Image::buildAnimateVerify(C('VERIFY_LENGTH'),C('VERIFY_MODE'),C('VERIFY_WIDTH'),C('VERIFY_HEIGHT'),'verify');				}			}?>