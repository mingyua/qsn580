<?phpclass UpfileAction extends Action {	function  index(){		$this->display();	}	public function exportExcel($expTitle,$expCellName,$expTableData){		$xlsTitle = iconv('utf-8', 'gb2312', $expTitle);//文件名称		$fileName = $_SESSION['username'].date('_YmdHis');//or $xlsTitle 文件名称可根据自己情况设定		$cellNum = count($expCellName);		$dataNum = count($expTableData);		Vendor("PHPExcel.PHPExcel");					$objPHPExcel = new PHPExcel();		$cellName = array('A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','AA','AB','AC','AD','AE','AF','AG','AH','AI','AJ','AK','AL','AM','AN','AO','AP','AQ','AR','AS','AT','AU','AV','AW','AX','AY','AZ');		$objPHPExcel->getActiveSheet(0)->mergeCells('A1:'.$cellName[$cellNum-1].'1');//合并单元格		// $objPHPExcel->setActiveSheetIndex(0)->setCellValue('A1', $expTitle.'  Export time:'.date('Y-m-d H:i:s'));		for($i=0;$i<$cellNum;$i++){			$objPHPExcel->setActiveSheetIndex(0)->setCellValue($cellName[$i].'2', $expCellName[$i][1]);		}		// Miscellaneous glyphs, UTF-8		for($i=0;$i<$dataNum;$i++){			for($j=0;$j<$cellNum;$j++){				$objPHPExcel->getActiveSheet(0)->setCellValue($cellName[$j].($i+3), $expTableData[$i][$expCellName[$j][0]]);			}		}		header('pragma:public');		header('Content-type:application/vnd.ms-excel;charset=utf-8;name="'.$xlsTitle.'.xls"');		header("Content-Disposition:attachment;filename=$fileName.xls");//attachment新窗口打印inline本窗口打印		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');		exit;	}	/**	 *	 * 导出Excel	 */	function expUser(){//导出Excel		$xlsName  = "User";		$xlsCell  = array(		array('id','企业序号'),		array('uid','用户ID'),		array('c_name','公司名称'),		array('c_hy','所属行业'),		array('c_zhuying','主营产品'),		array('c_severce','服务内容'),		array('c_pro','省份'),		array('c_city','城市'),		array('c_area','县区'),		array('c_address','详细地址'),		array('c_tel','联系电话'),		array('c_logo','公司形象'),		array('c_url','公司网址'),		array('c_peo','法人代表'),		array('c_card','身份证'),		array('c_yyzz','营业执照'),		array('c_contents','公司简介'),		array('c_regcash','注册资本'),		array('c_mode','公司规模'),		array('c_regtime','营业时间'),		array('c_stoptime','停业时间')		);		$xlsModel = M('company');		$xlsData  = $xlsModel->select();		//$xlsData  = $xlsModel->Field('id,uid,c_name,c_hy,c_zhuying,c_severce,c_pro,c_city,company,c_area,c_address,c_tel,c_logo,c_url,c_peo,c_card,c_yyzz,c_contents,c_regcash,c_mode,c_regtime,c_stoptime')->select();//用不起，可能是数据字段名有误。$field('这里是控制输出的字段名')		foreach ($xlsData as $k => $v)		{			//$xlsData[$k]['sex']=$v['sex']==1?'男':'女';			$xlsData[$k]['c_regtime']=date('Y-m-d', $v['c_regtime']);			$xlsData[$k]['c_stoptime']=date('Y-m-d', $v['c_stoptime']);		}		$this->exportExcel($xlsName,$xlsCell,$xlsData);				}	/**	 *	 * 显示导入页面 ...	 */	/**实现导入excel	 **/	function impUser(){		if (!empty($_FILES)) {			import('ORG.Net.UploadFile');			$config=array(                'allowExts'=>array('xlsx','xls'),                'savePath'=>'./Public/upload/',                'saveRule'=>'time',			);			$upload = new UploadFile($config);			if (!$upload->upload()) {				$this->error($upload->getErrorMsg());			} else {				$info = $upload->getUploadFileInfo();			}			  Vendor('PHPExcel.PHPExcel');			$file_name=$info[0]['savepath'].$info[0]['savename'];			$objReader = PHPExcel_IOFactory::createReader('Excel5');			$objPHPExcel = $objReader->load($file_name,$encode='utf-8');			$sheet = $objPHPExcel->getSheet(0);			$highestRow = $sheet->getHighestRow(); // 取得总行数			$highestColumn = $sheet->getHighestColumn(); // 取得总列数			for($i=3;$i<=$highestRow;$i++)			{				$data['uid'] = $objPHPExcel->getActiveSheet()->getCell("B".$i)->getValue();				$data['c_name'] = $objPHPExcel->getActiveSheet()->getCell("C".$i)->getValue();				$data['c_hy'] = $objPHPExcel->getActiveSheet()->getCell("D".$i)->getValue();			    $data['c_zhuying'] = $objPHPExcel->getActiveSheet()->getCell("E".$i)->getValue();				$data['c_severce'] = $objPHPExcel->getActiveSheet()->getCell("F".$i)->getValue();				$data['c_pro'] = $objPHPExcel->getActiveSheet()->getCell("G".$i)->getValue();				$data['c_city']= $objPHPExcel->getActiveSheet()->getCell("H".$i)->getValue();				$data['c_area']= $objPHPExcel->getActiveSheet()->getCell("I".$i)->getValue();				$data['c_address']= $objPHPExcel->getActiveSheet()->getCell("J".$i)->getValue();				$data['c_tel']= $objPHPExcel->getActiveSheet()->getCell("K".$i)->getValue();				$data['c_logo']=$objPHPExcel->getActiveSheet()->getCell("L".$i)->getValue();				$data['c_url']=$objPHPExcel->getActiveSheet()->getCell("M".$i)->getValue();				$data['c_peo']= $objPHPExcel->getActiveSheet()->getCell("N".$i)->getValue();				$data['c_card']=$objPHPExcel->getActiveSheet()->getCell("O".$i)->getValue();				$data['c_yyzz']=$objPHPExcel->getActiveSheet()->getCell("P".$i)->getValue();				$data['c_contents']=$objPHPExcel->getActiveSheet()->getCell("Q".$i)->getValue();				$data['c_regcash']=$objPHPExcel->getActiveSheet()->getCell("R".$i)->getValue();				$data['c_mode']=$objPHPExcel->getActiveSheet()->getCell("S".$i)->getValue();				$data['c_regtime']=strtotime($objPHPExcel->getActiveSheet()->getCell("T".$i)->getValue());				$data['c_stoptime']=strtotime($objPHPExcel->getActiveSheet()->getCell("U".$i)->getValue());				M('company')->add($data);								}			$this->success('导入成功！');		}else		{			$this->error("请选择上传的文件");		}				}}